<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>단건조회</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

	<script>
		window.addEventListener('DOMContentLoaded', function () {
			getReply();
		});

		// 댓글 가져오기(비동기통신 호출)
		function getReply() {
			const urlParams = new URLSearchParams(window.location.search);
			const myParam = urlParams.get('bno');

			const url = `/replies/pages/${myParam}/1`
			
			fetch(url)
			.then((result) => result.json())   // response.json() => 아직 promise상태
			.then((result) => getReplyProc(result.list));
		}

		// 가져온 댓글 처리하기 
		function getReplyProc(result) {
			
			const replys = document.querySelector(".replys");

			result.forEach(data => {
				console.log("data => ", data)
				const txt = document.createTextNode("\u00D7");
				const html = `<div class="row"><div class="col-8">${data.reply}</div><div class="col-3">${data.replyer}</div><div data-rno="${data.rno}" class="delBtn col-1">\u00D7</div></div>`
				replys.insertAdjacentHTML("beforeend", html)
			});

			// 삭제 이벤트 걸기
			let cardEle = document.querySelector(".card");

			cardEle.addEventListener("click", () => {
				let delBtn = event.target.className.split(" ");
				
				if(delBtn[0] == "delBtn") {
					removeProc();
				}
			});
		}

		function removeProc() {
			const div = event.target.closest(".row");
			const rno = event.target.dataset.rno;
			const url = `/replies/${rno}`
			fetch(url, {
				method: "DELETE", // *GET, POST, PUT, DELETE 등
			})
			.then((result) => result.text())
			.then((result) => div.remove())
		}
	</script>
</head>
<body>
	<div class="container">
		<h3 class="d-block text-center mt-3 mb-2" th:text="|${board.bno}게시글 조회|"></h3>
		<table class="table">
			<tr>
				<th>번호</th>
				<td th:text="${board.bno}"></td>
			</tr>
			<tr>
				<th>제목</th>
				<td th:text="${board.title}"></td>
			</tr>
			<tr>
				<th>내용</th>
				<td th:text="${board.content}"></td>
			</tr>
			<tr>
				<th>작성자</th>
				<td th:text="${board.writer}"></td>
			</tr>
			<tr>
				<th>작성일자</th>
				<td th:text="${board.regdate}"></td>
			</tr>
		</table>
		<div class="mx-auto text-center">
			<button type="button" class="btn btn-success" th:onclick="|location.href='modify?bno=${board.bno}'|">수정</button>
			<button type="button" class="btn btn-danger" th:onclick="|location.href='remove?bno=${board.bno}'|">삭제</button>
		</div>

		<div class="card">
			<div class="card-header">댓글</div>
			<div class="card-body replys"></div>
		</div>
	</div>
</body>
</html>